{%  load i18n %}
{% include "partials/header.html" %}
{% include "components/banner.html" %}

    <main class="wrapper">
      {% include "partials/sidemenu.html" with active_tab="home" %}

      <div class="content">
        
        <div class="aside">
          <h1 class="page-title">Matches</h1>
        </div>

        <div class="aside">
          <span class="matches">Samlede antal: <span id="number_of_matches"></span></span>
        </div>

        {% include "components/filters.html" %}

        {% if page_obj.paginator.count == 0 %}
          <span class="datatable-none-matches">
            {% trans "No matches were found" %}
          </span>
        {% else %}
          {% include "components/hits.html" %}
        {% endif %}
        <div id="all_matches"></div>
      </div>

    </main>

    {% include "partials/scripts.html" %}
    <script>

        var formData = document.querySelector("#filter_form")
        
        var wsStart = window.location.protocol == 'https:' ? 'wss://' : 'ws://'
        var endpoint = wsStart + window.location.host + window.location.pathname
        
        var socket = new WebSocket(endpoint)

        socket.onmessage = function(e){
            console.log("message", e);
            const data = JSON.parse(e.data);
            console.log(data);
            $("#number_of_matches").html(data.length)
            $("#all_matches").empty()
            for (i=0;i<data.length;i++) {
              var test = `
                <tr tabindex="0" data-type="{{ type }}">
                  <td colspan="3">
                    <table class="datatable datatable--nested">
                      <tbody>
                        <tr>
                          <td class="datatable__column--match">
                            <span class="more">
                              ${data[i].matches.handle.path}
                            </span>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                </tr>    
                        `
              // for (j=0;j<data[i].matches.matches[0].matches.length;j++) {
              //   test += `
              //     <tr>
              //       <td class="datatable__column--match">
              //           <span class="more">
                            
              //           </span>
              //       </td>
              //       <td class="datatable__column--context">
              //           {% if match.context %}
                            
              //           {% endif %}
              //       </td>
              //       <td class="datatable__column--probability">
              //           {% include "components/probability.html"%}
              //       </td>
              //     </tr>`
              // }

              $("#all_matches").append(test)
            }
        };
        socket.onopen = function(e){
            console.log("open", e);
            $("#number_of_matches").html("Hola")
        };
        socket.onerror = function(e){
            console.log("error", e)
        };
        socket.onclose = function(e){
            console.log("close", e)
        };

    </script>

</body>
</html>